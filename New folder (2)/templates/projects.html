{% extends 'base.html' %}

{% block content %}
    <section id="projects">
        <h2>My Projects</h2>
        <div class="projects-container">
            {% for project in projects %}
                <div class="project-card" id="project-{{ project.id }}">
                    <img src="{{ url_for('static', filename=project.image) }}" alt="{{ project.title }}">
                    <h3>{{ project.title }}</h3>
                    <p>{{ project.description }}</p>
                    <a href="{{ project.live_demo }}" target="_blank">Live Demo</a>
                    <div class="rating">
                        <p>Rating: <span class="avg-rating">{{ "%.1f"|format(project.avg_rating) }}</span>/5</p>
                        <div class="stars" data-project-id="{{ project.id }}">
                            {% for i in range(1, 6) %}
                                <span class="star" data-value="{{ i }}">&#9733;</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </section>
    <script>
        document.querySelectorAll('.stars').forEach(starsContainer => {
            starsContainer.addEventListener('click', event => {
                if (event.target.classList.contains('star')) {
                    const rating = event.target.dataset.value;
                    const projectId = starsContainer.dataset.projectId;
                    
                    fetch(`/rate_project/${projectId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ rating: parseInt(rating) })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            document.querySelector(`#project-${projectId} .avg-rating`).textContent = data.avg_rating.toFixed(1);
                        }
                    });
                }
            });
        });
    </script>
{% endblock %}
